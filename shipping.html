<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>D‚Äôlia Ornaments PH | Shipping</title>
  <link rel="stylesheet" href="styles/shipping.css" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet" />
  <link rel="icon" href="assets/home/logo.png" />
</head>

<body>
  <main class="shipping-container">
    <header class="shipping-header">
      <h1 class="brand-title">D‚Äôlia Ornaments PH</h1>
      <nav class="breadcrumb">
        <a href="checkout.html">Information</a> ‚Ä∫ 
        <strong>Shipping</strong> ‚Ä∫ 
        <span style="color: #ccc;">Payment</span>
      </nav>
    </header>

    <div class="checkout-layout">
      <section class="left-section">
        <div class="info-cards">
          <div class="info-card">
            <div class="info-label">üìû Contact</div>
            <div class="info-details" id="contact-email">your@email.com</div>
            <a href="checkout.html" class="info-change">Change</a>
          </div>

          <div class="info-card">
            <div class="info-label">üìç Ship to</div>
            <div class="info-details" id="shipping-address">Your address here</div>
            <a href="checkout.html" class="info-change">Change</a>
          </div>
        </div>

        <h2>Shipping Method</h2>
        <form id="shipping-form">
          <label class="method-card">
            <input type="radio" name="shipping" value="same-day" checked>
            <div class="method-info">
              <div class="method-title">üõµ Same Day Delivery</div>
              <p class="method-desc">Schedule and Fees Vary, Booked via Lalamove/Grab. Cut-off 4PM.</p>
            </div>
          </label>

          <label class="method-card">
            <input type="radio" name="shipping" value="standard">
            <div class="method-info">
              <div class="method-title">üöö Standard Shipping</div>
              <p class="method-desc">Available Nationwide, Fees Vary</p>
            </div>
          </label>

          <div class="form-actions">
            <a href="checkout.html" class="back-link">‚Üê Return to Information</a>
            <button type="submit" class="next-btn">Continue to Payment</button>
          </div>
        </form>
      </section>

      <aside class="right-section">
        <h3>Your Order</h3>
        <div id="order-items"></div>
        
        <div class="order-summary">
          <div>Subtotal: <span id="subtotal">‚Ç±0.00</span></div>
          <div>Shipping: <span id="shipping-fee">May vary</span></div>
          <hr />
          <div class="total">Total: <span id="total">‚Ç±0.00</span></div>
        </div>
      </aside>
    </div>

    <section class="bracelet-preview-section">
      <h2 class="bracelet-preview-section">Your Customized Bracelet Preview</h2>
      <div class="bracelet-preview-wrapper" id="bracelet-preview-wrapper" style="display:none;">
        <img id="bracelet-preview-img" alt="Bracelet Preview">
      </div>
    </section>
  </main>

  <footer>
    <p>¬© 2025 D'lia Ornaments PH | All Rights Reserved.</p>
  </footer>

  <script>
  document.addEventListener("DOMContentLoaded", () => {
    const fmt = n => "‚Ç±" + n.toFixed(2);

    // --- 1. Load User Info ---
    const info = JSON.parse(localStorage.getItem("checkoutInfo") || "{}");
    document.getElementById("contact-email").textContent = info.email || "‚Äî";
    document.getElementById("shipping-address").textContent =
      `${info.address || ""}, ${info.postal || ""} ${info.city || ""}, ${info.region || ""}`;

    // --- 2. Bracelet Preview Logic ---
    const previewUrl = localStorage.getItem("braceletPreviewImage");
    const wrapper = document.getElementById("bracelet-preview-wrapper");
    const img = document.getElementById("bracelet-preview-img");
    if (previewUrl) {
      img.src = previewUrl;
      wrapper.style.display = "block";
    }

    function renderSidebar() {
      const cart = JSON.parse(localStorage.getItem("cartItems") || "[]");
      const braceletColor = localStorage.getItem("braceletColor");
      const braceletSize = localStorage.getItem("braceletSize") || "Medium";
      const orderItemsContainer = document.getElementById('order-items');
      
      let subtotal = 0;
      let html = '';

      // --- 1. Add Bracelet Link ---
      if (braceletColor) {
        const prices = {
          silver: { Small: 240, Medium: 255, Large: 270, "Extra Large": 285, "Extra Extra Large": 300 },
          gold: { Small: 400, Medium: 425, Large: 450, "Extra Large": 475, "Extra Extra Large": 500 },
          mixed: { Small: 480, Medium: 510, Large: 540, "Extra Large": 570, "Extra Extra Large": 600 }
        };
        let key = braceletColor.toLowerCase().includes("gold") && !braceletColor.toLowerCase().includes("mixed") ? "gold" : (braceletColor.toLowerCase().includes("mixed") ? "mixed" : "silver");
        const bprice = prices[key]?.[braceletSize] || 0;
        subtotal += bprice;

        html += `
          <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 12px; font-size: 0.9rem;">
            <div style="display: flex; align-items: center; gap: 10px;">
              <div style="width: 50px; height: 50px; background: #eee; border-radius: 8px; overflow: hidden; border: 1px solid #ddd; flex-shrink:0;">
                <img src="assets/bracelets/${key}.png" style="width:100%; height:100%; object-fit: cover;">
              </div>
              <div>
                <div style="font-weight: 500; color: #333;">${braceletColor} Bracelet (${braceletSize})</div>
                <div style="font-size: 0.8em; color: #888;">Qty: 1</div>
              </div>
            </div>
            <div style="display: flex; align-items: center; gap: 12px;">
              <div style="font-weight: 600; color: #2b0f0f;">${fmt(bprice)}</div>
              <button class="remove-btn" onclick="removeBracelet()" style="cursor:pointer; background:none; border:none; color:#a00; font-weight:bold;">‚úï</button>
            </div>
          </div>`;
      }

      // --- 2. Add Charms ---
      cart.forEach((item, index) => {
        const itemTotal = (item.price || 0) * (item.quantity || 1);
        subtotal += itemTotal;
        html += `
          <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 12px; font-size: 0.9rem;">
            <div style="display: flex; align-items: center; gap: 10px;">
              <div style="width: 50px; height: 50px; background: #eee; border-radius: 8px; overflow: hidden; border: 1px solid #ddd; flex-shrink:0;">
                <img src="${item.img}" style="width:100%; height:100%; object-fit: cover;">
              </div>
              <div>
                <div style="font-weight: 500; color: #333;">${item.name}</div>
                <div style="font-size: 0.8em; color: #888;">Qty: ${item.quantity}</div>
              </div>
            </div>
            <div style="display: flex; align-items: center; gap: 12px;">
              <div style="font-weight: 600; color: #2b0f0f;">${fmt(itemTotal)}</div>
              <button class="remove-btn" onclick="removeItem(${index})" style="cursor:pointer; background:none; border:none; color:#a00; font-weight:bold;">‚úï</button>
            </div>
          </div>`;
      });

      orderItemsContainer.innerHTML = html;
      document.getElementById('subtotal').textContent = fmt(subtotal);
      document.getElementById('total').textContent = fmt(subtotal);
    }

    // Function to remove items
    window.removeItem = (index) => {
      let cart = JSON.parse(localStorage.getItem("cartItems") || "[]");
      cart.splice(index, 1);
      localStorage.setItem("cartItems", JSON.stringify(cart));
      renderSidebar();
    };

    window.removeBracelet = () => {
      localStorage.removeItem("braceletColor");
      localStorage.removeItem("braceletSize");
      localStorage.removeItem("braceletPrice");
      renderSidebar();
    };

    renderSidebar();

    // --- 4. Form Submission ---
    document.getElementById('shipping-form').addEventListener('submit', (e) => {
      e.preventDefault();
      const selected = document.querySelector("input[name='shipping']:checked").value;
      localStorage.setItem('shippingMethod', selected);
      window.location.href = 'payment.html';
    });
  });
  </script>
</body>
</html>